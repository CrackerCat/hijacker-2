<?xml version="1.0"?>
<hijacker:Rules xmlns:hijacker="http://www.dis.uniroma1.it/~hpdcs/">

  <hijacker:Executable reverseDebug="true" entryPoint="foo">

    <hijacker:Inject file="foo.S" />


    <hijacker:Instruction instruction="I_MEMWR|I_MEMRD" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
      <hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="stdcall" />
    </hijacker:Instruction>


    <hijacker:Instruction instruction="I_MEMWR|I_MEMRD" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
      <hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="stdcall" />
    </hijacker:Instruction>


    <hijacker:Instruction instruction="I_MEMWR|I_MEMRD" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
      <hijacker:AddCall where="pre" function="monitor2" arguments="qualcosa" convention="stdcall" />
    </hijacker:Instruction>


    <hijacker:Function name="bar" reverseDebug="true" preamble="func_pre" postamble="func_post">
      <hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="asmlinkage" />
      <hijacker:Instruction instruction="I_JUMP" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
        <hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="stdcall" />
      </hijacker:Instruction>
    </hijacker:Function>


    <hijacker:Function name="bar" reverseDebug="false" preamble="func_pre" postamble="func_post">
      <hijacker:AddCall where="post" function="monitor3" arguments="qualcosa" convention="asmlinkage" />
      <hijacker:Instruction instruction="I_JUMP" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
        <hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="stdcall" />
      </hijacker:Instruction>
      <hijacker:Instruction instruction="I_JUMP" injectBefore="foo.S" injectAfter="foo.S" replace="foo.S">
        <hijacker:AddCall where="pre" function="monitorrrr" arguments="qualcosa" convention="stdcall" />
      </hijacker:Instruction>
    </hijacker:Function>


    <hijacker:Range depthCall="true" callRepeatRule="false">
         <hijacker:Begin>
		    <hijacker:Function name="foobar"/>
         </hijacker:Begin>
         <hijacker:End>
		    <hijacker:Offset value="0xdeadc0de" />
         </hijacker:End>
	 
	 <hijacker:Instruction instruction="I_STACK">
        	<hijacker:AddCall where="pre" function="monitor" arguments="qualcosa" convention="stdcall" />
 	 </hijacker:Instruction>
    </hijacker:Range>


  </hijacker:Executable>

</hijacker:Rules>
